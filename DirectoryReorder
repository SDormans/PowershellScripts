<#
.SYNOPSIS
    Organizes documents, photos, and music on drive F:\

.DESCRIPTION
    SECTION 1:
        - Moves document files into a Personal folder

    SECTION 2:
        - Consolidates photos into the Photos root
        - Moves non-photo files into an Others folder
        - Cleans up empty directories

    SECTION 3:
        - Cleans music folders
        - Removes _MACOSX artifacts
        - Deduplicates album folders
#>

#################################################
# SECTION 1: Move Documents to Personal Folder
#################################################

$SourceFolder   = "F:\"
$PersonalFolder = "F:\Persoonlijk"

# Supported document extensions
$DocumentExtensions = @(
    ".doc", ".docx", ".pdf",
    ".xls", ".xlsx", ".csv",
    ".ppt", ".pptx",
    ".txt", ".rtf"
)

# Ensure Personal folder exists
if (-not (Test-Path -Path $PersonalFolder)) {
    New-Item -ItemType Directory -Path $PersonalFolder | Out-Null
}

# Find and move document files
Get-ChildItem -Path $SourceFolder -Recurse -File |
Where-Object { $DocumentExtensions -contains $_.Extension.ToLower() } |
ForEach-Object {

    $Destination = Join-Path $PersonalFolder $_.Name

    # Prevent overwriting existing files
    if (-not (Test-Path -Path $Destination)) {
        Move-Item -Path $_.FullName -Destination $PersonalFolder
    }
}

#################################################
# SECTION 2: Organize Photos
#################################################

$PhotoRoot    = "F:\Fotos"
$OthersFolder = Join-Path $PhotoRoot "Others"

# Supported photo & video extensions
$PhotoExtensions = @(
    ".jpg", ".jpeg", ".png",
    ".heic", ".mp4"
)

# Ensure Others folder exists
if (-not (Test-Path -Path $OthersFolder)) {
    New-Item -ItemType Directory -Path $OthersFolder | Out-Null
}

# Move all photos/videos into the Photos root
Get-ChildItem -Path $PhotoRoot -Recurse -File |
Where-Object { $PhotoExtensions -contains $_.Extension.ToLower() } |
ForEach-Object {

    $Destination = Join-Path $PhotoRoot $_.Name

    if (-not (Test-Path -Path $Destination)) {
        Move-Item -Path $_.FullName -Destination $PhotoRoot
    }
}

# Move non-photo files into Others
Get-ChildItem -Path $PhotoRoot -Recurse -File |
Where-Object { $PhotoExtensions -notcontains $_.Extension.ToLower() } |
ForEach-Object {

    $Destination = Join-Path $OthersFolder $_.Name

    if (-not (Test-Path -Path $Destination)) {
        Move-Item -Path $_.FullName -Destination $OthersFolder
    }
}

# Remove empty directories (excluding Others)
Get-ChildItem -Path $PhotoRoot -Recurse -Directory |
Where-Object { $_.FullName -ne $OthersFolder } |
Sort-Object FullName -Descending |
Remove-Item -Force

#################################################
# SECTION 3: Organize Music Library
#################################################

$MusicRoot     = "F:\Muziek"
$DuplicatesDir = Join-Path $MusicRoot "Duplicates"

# Supported music extensions
$MusicExtensions = @(
    ".mp3", ".flac", ".wav",
    ".aac", ".m4a"
)

# Ensure Duplicates folder exists
if (-not (Test-Path -Path $DuplicatesDir)) {
    New-Item -ItemType Directory -Path $DuplicatesDir | Out-Null
}

# Remove macOS metadata folders
Get-ChildItem -Path $MusicRoot -Recurse -Directory -Force |
Where-Object { $_.Name -eq "_MACOSX" } |
Remove-Item -Recurse -Force

# Process directories from deepest level upward
Get-ChildItem -Path $MusicRoot -Recurse -Directory |
Sort-Object FullName -Descending |
ForEach-Object {

    # Skip root and Duplicates folder
    if ($_.FullName -eq $MusicRoot -or $_.FullName -eq $DuplicatesDir) {
        return
    }

    # Check if directory contains music files
    $ContainsMusic = Get-ChildItem -Path $_.FullName -Recurse -File |
        Where-Object { $MusicExtensions -contains $_.Extension.ToLower() } |
        Select-Object -First 1

    if ($ContainsMusic) {

        $Destination = Join-Path $MusicRoot $_.Name

        # Move duplicate folder if name already exists
        if (Test-Path -Path $Destination) {
            Move-Item -Path $_.FullName -Destination $DuplicatesDir -Force
        } else {
            Move-Item -Path $_.FullName -Destination $MusicRoot
        }

    } else {
        # Remove folders without music content
        Remove-Item -Path $_.FullName -Recurse -Force
    }
}
